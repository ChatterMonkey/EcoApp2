<!DOCTYPE html>
<html>
<head>

    <link href="https://fonts.googleapis.com/css?family=Comfortaa&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="homeStyle2.css">


<meta name="viewport" content="width=device-width, initial-scale=1">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>









<style>

</style>




</head>
<body>











<div id="logged-in-user" class="user-info" class="in"></div>








<div id="header">    <!-- This is the header for blue green -->
    <p id="header-text">   <!-- This is the header text, it is seperate to add padding -->
        Blue Green Shift
    </p>
</div>





<div id="left-column">  <!-- This is the left most information, which is a list of action button -->
    <div id="login-logout">


        <button id="logout" onclick="logout()">logout</button>

     <button id="login" onclick="openForm()">login</button>
        <a href="info.html">Information Page</a>



        <div id="form-popup">
            <div id="form-wrapper">
                    Username<br>
                    <input id="username" type="text" name="Username" value=""><br>
                Password<br>
                    <input id="paswd" type="text" name="Password" value=""><br><br>
                <button id="submit" onclick="closeForm()">Submit!</button>
                <button onclick="closeForm()">Cancel</button>


            </div>


        </div>



    </div>


    <div id="user-actions" class="in">


<div  class="button-img-group" onclick="opencForm(1); "    id = "1">
    <div style="font-size:32px;">Click here every time you complete this action</div>
    <br>

    Avoid using a disposable plastic container. You can achieve this by using a reusable cup, water bottle, or takeout container. Or you can choose not to use the item int he first place.

    <br>

</div>
     <button class="info_button"  onclick="window.location.href = 'info.html#plasticcontainers';">Why this helps, and how to do it.</button>






<div class="button-img-group" onclick="opencForm(2);"   id="2">
    <div style="font-size:32px;">Click here every time you complete this action</div>

    <br>
    Reuse old bags or use reusable bags or containers to avoid wasting plastic bags such as (but not limited to): grocery bags, produce bags, ziplock lunch bags, and takeout bags.
</div>
 <button class="info_button" onclick="window.location.href = 'info.html#plasticbags';">Why this helps, and how to do it.</button>








<div  class="button-img-group" onclick="opencForm(3);"   id="3">
    <div style="font-size:32px;">Click here every time you complete this action</div>
    <br>
    Avoid using single use plastic. (Use this action for items that don't fit within the top two categories )
</div>

<button class="info_button"  onclick="window.location.href = 'info.html#otherplastic';">Why this helps, and how to do it.</button>





<div  class="button-img-group" onclick="opencForm(4);"   id="4">
    <div style="font-size:32px;">Click here every time you complete this action</div>
    <br>
    Car pool or take public transportation.
</div>

<button class="info_button"  onclick="window.location.href = 'info.html#carpool';">Why this helps, and how to do it.</button>




<div  class="button-img-group" onclick="opencForm(5);"    id="5">
    <div style="font-size:32px;">Click here every time you complete this action</div>
    <br>
    Walk or bike instead of driving.
</div>

<button class="info_button"  onclick="window.location.href = 'info.html#bikingwalking';">Why this helps, and how to do it.</button>




<div  class="button-img-group" onclick="opencForm(6);"  id="6">
    <div style="font-size:32px;">Click here every time you complete this action</div>
    <br>
    Save food from being wasted - cook with some veggies that are about to go bad, or eat leftovers that would otherwise go to waste.
</div>

<button class="info_button"  onclick="window.location.href = 'info.html#foodwaste';">Why this helps, and how to do it.</button>






<div  class="button-img-group" onclick="opencForm(7);"  id="7">
    <div style="font-size:32px;">Click here every time you complete this action</div>
    <br>
    Take a short shower instead of a bath.
</div>

<button class="info_button"  onclick="window.location.href = 'info.html#water';">Why this helps, and how to do it.</button>





<div  class="button-img-group" onclick="opencForm(8);" id="8">
    <div style="font-size:32px;">Click here every time you complete this action</div>
    <br>
    Eat vegetarian for a day.
</div>

<button class="info_button"  onclick="window.location.href = 'info.html#vegetarian';">Why this helps, and how to do it.</button>






<div  class="button-img-group" onclick="openForm(9);"  id="9">
    <div style="font-size:32px;">Click here every time you complete this action</div>
    <br>
    Buy produce locally.
</div>

<button class="info_button"  onclick="window.location.href = 'info.html#eatlocal';">Why this helps, and how to do it.</button>





<div class="button-img-group" onclick="opencForm(10);"   id="10">
    <div style="font-size:32px;">Click here every time you complete this action</div>
    <br>
    Wash clothes in cold water.
</div>
    <button class="info_button"  onclick="window.location.href = 'info.html#clothes';">Why this helps, and how to do it.</button>







    </div>



</div>

















   <div id="form-popup-confirm">
            <div id="form-wrapper-confirm">
                <div id="textformwrapper">

                    Please confirm that you completed the following action:   <br> <br>


                    <div id="confirm_div"> </div>

                          <br> <br>
                     <button onclick="closecForm(0)" style="font-size: large">Confirm </button>
                <button onclick="closecForm(1)"    style="font-size: large"  >Cancel </button>









                            </div>



                        </div>



                    </div>

                </div>







                    </div>
            </div>
        </div>








<script>


function claimGift(id) {



var gift = document.getElementById("gift");
    gift.classList.add("claimed");


    document.getElementById("gift").style.display = "none";

    document.getElementById("r_popup").style.display = "block";
    document.getElementById("r_wrapper").style.display = "block";





        $.post("/register_action", {"actionid": id, "userid":localStorage.getItem("UserID")}, function(data,status){
        console.log("data");
        console.log(data);
        pointsearned=data;
        document.getElementById("rewardtext").innerHTML = pointsearned;
        document.getElementById("rewarddiv").classList.remove("faded");
//      document.getElementById("form-popup").style.display = "inline-block";
//  document.getElementById("rewarddiv").style.opacity = "1";
   //document.getElementById("rewarddiv").style.backgroundColor = "red";

  //document.getElementById("rewarddiv").classList.add("faded");
  //document.getElementById("rewarddiv").classList.add("faded");



  $(function() {
 // Handler for .ready() called.
 $('#rewarddiv').addClass('faded');
});




        });





}

function openForm() {
  document.getElementById("form-popup").style.display = "block";
}

function closeForm() {
  document.getElementById("form-popup").style.display = "none";
}


function logout() {
    localStorage.setItem("UserID", "");

    location.reload();
}
function close_claim_overlay() {
    document.getElementById("r_popup").style.display = "none";

//reward user


}
function closeGift() {




    document.getElementById("r_popup").style.display = "none";
    document.getElementById("r_wrapper").style.display = "none";

set_up_page();

location.reload();

    }

</script>

<script>


function is_user_logged_in(){
    if (("UserID" in localStorage) && (localStorage.getItem("UserID") !== "") && (localStorage.getItem("UserID") !== "undefined")){
        console.log(localStorage.getItem("UserID"));
        console.log("user is logged in");
        return true;
    }
    else{
        console.log(localStorage.getItem("UserID"));
        return false;
    }
}

function refresh_user_data(userid){

    $.post("/get_user_info", {userID: localStorage.getItem("UserID")}, function(data, status){

            localStorage.setItem("UserID", data["id"]);
            localStorage.setItem("UserName", data["username"]);
            localStorage.setItem("xp", data["xp"]);
            console.log("refreshing data, new xp:");
            console.log(localStorage.getItem("xp"));
            localStorage.setItem("cc", data["cc"]);






    }   );
}



function logged_in_document_display(){

    document.getElementById('login').style.display='none';


    document.getElementById('logout').style.display='inline-block';
    document.getElementById("user-actions").style.display = "block";
    document.getElementById("logged-in-user").innerHTML = localStorage.getItem("UserName");


}


function logged_out_document_display(){

    document.getElementById('login').style.display='inline-block';



    document.getElementById('logout').style.display='none';
    document.getElementById("user-actions").style.display = "none";
    document.getElementById("logged-in-user").style.display = "none";


}



function set_up_page(){
    console.log("set up page called");


    if (is_user_logged_in() === true){



        refresh_user_data(1);
        console.log("data refreshed");




        logged_in_document_display();






        console.log("setting up progress bar");






    }
    else{
        logged_out_document_display()


    }
}

$(document).ready(function(){
    localStorage.setItem("bla", "bitty");


    window.onload = set_up_page();




    $("#submit").click(function(){

        var username = document.getElementById("username").value
        var password = document.getElementById("paswd").value
        console.log(username);
        console.log(password);

        $.post("/post_login_data",
            {
                username: username,
                password: password,
            },
            function(data, status){

                if(data["status"] == "true"){
                    localStorage.clear();

                    localStorage.setItem("UserID", data["id"]);


                    localStorage.setItem("UserName", data["username"]);
                    localStorage.setItem("xp", data["xp"]);
                    localStorage.setItem("cc", data["cc"]);




                    location.reload();


                }
                else{
                    alert(data["message"])
                    //alert("The username or password you provided was incorrect, please try again. If you have lost your username or password, or problems persist, please contact bluegreenshift@gmail.com for help.")
                }

            });
    });

});







</script>








<script>





function opencForm(id) {

working_action = id;



$.post("/get_user_info", {userID: localStorage.getItem("UserID")}, function(data, status){

        localStorage.setItem("UserID", data["id"]);
        localStorage.setItem("UserName", data["username"]);
        localStorage.setItem("xp", data["xp"]);
        localStorage.setItem("cc", data["cc"]);


    });


$.post("/return_action_message", {"actionid": id}, function(data,status){

        console.log("data");
        console.log(data);
        message=data;
        document.getElementById("confirm_div").innerHTML = message;


  document.getElementById("form-popup-confirm").style.display = "inline-block";



});





}




function closecForm(id) {


    if (id == 0){
            console.log("confirmed action");

            $.post("/register_action", {"actionid": working_action, "userid":localStorage.getItem("UserID")}, function(data,status){

                    console.log("logged action: ");
                    console.log(data);
                    document.getElementById("form-popup-confirm").style.display = "none";

            });


    }




    if (id ==1){
    document.getElementById("form-popup-confirm").style.display = "none";
    }


};

</script>

</body>
</html>

